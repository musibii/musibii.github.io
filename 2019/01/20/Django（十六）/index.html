<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Django（十六） | rsuxwvilc</title><meta name="author" content="vilc"><meta name="copyright" content="vilc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Django 系列博客（十六）前言本篇博客介绍 Django 的 forms 组件。 基本属性介绍创建 forms 类时，主要涉及到字段和插件，字段用于对用户请求数据的验证，插件用于自动生成 html。 Form 类内置字段介绍12345678910111213141516171819202122232425262728293031323334353637383940414243444546474">
<meta property="og:type" content="article">
<meta property="og:title" content="Django（十六）">
<meta property="og:url" content="https://rsuxwvilc.github.io/2019/01/20/Django%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89/index.html">
<meta property="og:site_name" content="rsuxwvilc">
<meta property="og:description" content="Django 系列博客（十六）前言本篇博客介绍 Django 的 forms 组件。 基本属性介绍创建 forms 类时，主要涉及到字段和插件，字段用于对用户请求数据的验证，插件用于自动生成 html。 Form 类内置字段介绍12345678910111213141516171819202122232425262728293031323334353637383940414243444546474">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2019-01-20T04:45:06.000Z">
<meta property="article:modified_time" content="2019-10-18T06:23:44.000Z">
<meta property="article:author" content="vilc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://rsuxwvilc.github.io/2019/01/20/Django%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Django（十六）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2019-10-18 14:23:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">141</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">39</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">rsuxwvilc</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Django（十六）<a class="post-edit-link" href="https://github.com/rsuxwvilc/rsuxwvilc.github.io/tree/master_posts/Django（十六）.md" title="Edited on" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2019-01-20T04:45:06.000Z" title="Created 2019-01-20 12:45:06">2019-01-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2019-10-18T06:23:44.000Z" title="Updated 2019-10-18 14:23:44">2019-10-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django/">Django</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>19min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Django（十六）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="Django-系列博客（十六）"><a href="#Django-系列博客（十六）" class="headerlink" title="Django 系列博客（十六）"></a>Django 系列博客（十六）</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本篇博客介绍 Django 的 forms 组件。</p>
<h2 id="基本属性介绍"><a href="#基本属性介绍" class="headerlink" title="基本属性介绍"></a>基本属性介绍</h2><p>创建 forms 类时，主要涉及到字段和插件，字段用于对用户请求数据的验证，插件用于自动生成 html。</p>
<h3 id="Form-类内置字段介绍"><a href="#Form-类内置字段介绍" class="headerlink" title="Form 类内置字段介绍"></a>Form 类内置字段介绍</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">Field</span><br><span class="line">    required=<span class="literal">True</span>,               是否允许为空</span><br><span class="line">    widget=<span class="literal">None</span>,                 HTML插件</span><br><span class="line">    label=<span class="literal">None</span>,                  用于生成Label标签或显示内容</span><br><span class="line">    initial=<span class="literal">None</span>,                初始值</span><br><span class="line">    help_text=<span class="string">&#x27;&#x27;</span>,                帮助信息(在标签旁边显示)</span><br><span class="line">    error_messages=<span class="literal">None</span>,         错误信息 &#123;<span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;不能为空&#x27;</span>, <span class="string">&#x27;invalid&#x27;</span>: <span class="string">&#x27;格式错误&#x27;</span>&#125;</span><br><span class="line">    show_hidden_initial=<span class="literal">False</span>,   是否在当前插件后面再加一个隐藏的且具有默认值的插件（可用于检验两次输入是否一直）</span><br><span class="line">    validators=[],               自定义验证规则</span><br><span class="line">    localize=<span class="literal">False</span>,              是否支持本地化</span><br><span class="line">    disabled=<span class="literal">False</span>,              是否可以编辑</span><br><span class="line">    label_suffix=<span class="literal">None</span>            Label内容后缀</span><br><span class="line">    </span><br><span class="line">CharField(Field)</span><br><span class="line">    max_length=<span class="literal">None</span>,             最大长度</span><br><span class="line">    min_length=<span class="literal">None</span>,             最小长度</span><br><span class="line">    strip=<span class="literal">True</span>                   是否移除用户输入空白</span><br><span class="line">  </span><br><span class="line">IntegerField(Field)</span><br><span class="line">    max_value=<span class="literal">None</span>,              最大值</span><br><span class="line">    min_value=<span class="literal">None</span>,              最小值</span><br><span class="line">  </span><br><span class="line">FloatField(IntegerField)</span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">DecimalField(IntegerField)</span><br><span class="line">    max_value=<span class="literal">None</span>,              最大值</span><br><span class="line">    min_value=<span class="literal">None</span>,              最小值</span><br><span class="line">    max_digits=<span class="literal">None</span>,             总长度</span><br><span class="line">    decimal_places=<span class="literal">None</span>,         小数位长度</span><br><span class="line">  </span><br><span class="line">BaseTemporalField(Field)</span><br><span class="line">    input_formats=<span class="literal">None</span>          时间格式化  </span><br><span class="line">  </span><br><span class="line">DateField(BaseTemporalField)    格式：<span class="number">2015</span>-09-01</span><br><span class="line">TimeField(BaseTemporalField)    格式：<span class="number">11</span>:<span class="number">12</span></span><br><span class="line">DateTimeField(BaseTemporalField)格式：<span class="number">2015</span>-09-01 <span class="number">11</span>:<span class="number">12</span></span><br><span class="line">  </span><br><span class="line">DurationField(Field)            时间间隔：%d %H:%M:%S.%f</span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">RegexField(CharField)</span><br><span class="line">    regex,                      自定制正则表达式</span><br><span class="line">    max_length=<span class="literal">None</span>,            最大长度</span><br><span class="line">    min_length=<span class="literal">None</span>,            最小长度</span><br><span class="line">    error_message=<span class="literal">None</span>,         忽略，错误信息使用 error_messages=&#123;<span class="string">&#x27;invalid&#x27;</span>: <span class="string">&#x27;...&#x27;</span>&#125;</span><br><span class="line">  </span><br><span class="line">EmailField(CharField)     </span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">FileField(Field)</span><br><span class="line">    allow_empty_file=<span class="literal">False</span>     是否允许空文件</span><br><span class="line">  </span><br><span class="line">ImageField(FileField)     </span><br><span class="line">    ...</span><br><span class="line">    注：需要PIL模块，pip3 install Pillow</span><br><span class="line">    以上两个字典使用时，需要注意两点：</span><br><span class="line">        - form表单中 enctype=<span class="string">&quot;multipart/form-data&quot;</span></span><br><span class="line">        - view函数中 obj = MyForm(request.POST, request.FILES)</span><br><span class="line">  </span><br><span class="line">URLField(Field)</span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">BooleanField(Field) </span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">NullBooleanField(BooleanField)</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">ChoiceField(Field)</span><br><span class="line">    ...</span><br><span class="line">    choices=(),                选项，如：choices = ((<span class="number">0</span>,<span class="string">&#x27;上海&#x27;</span>),(<span class="number">1</span>,<span class="string">&#x27;北京&#x27;</span>),)</span><br><span class="line">    required=<span class="literal">True</span>,             是否必填</span><br><span class="line">    widget=<span class="literal">None</span>,               插件，默认select插件</span><br><span class="line">    label=<span class="literal">None</span>,                Label内容</span><br><span class="line">    initial=<span class="literal">None</span>,              初始值</span><br><span class="line">    help_text=<span class="string">&#x27;&#x27;</span>,              帮助提示</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">ModelChoiceField(ChoiceField)</span><br><span class="line">    ...                        django.forms.models.ModelChoiceField</span><br><span class="line">    queryset,                  <span class="comment"># 查询数据库中的数据</span></span><br><span class="line">    empty_label=<span class="string">&quot;---------&quot;</span>,   <span class="comment"># 默认空显示内容</span></span><br><span class="line">    to_field_name=<span class="literal">None</span>,        <span class="comment"># HTML中value的值对应的字段</span></span><br><span class="line">    limit_choices_to=<span class="literal">None</span>      <span class="comment"># ModelForm中对queryset二次筛选</span></span><br><span class="line">      </span><br><span class="line">ModelMultipleChoiceField(ModelChoiceField)</span><br><span class="line">    ...                        django.forms.models.ModelMultipleChoiceField</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      </span><br><span class="line">TypedChoiceField(ChoiceField)</span><br><span class="line">    coerce = <span class="keyword">lambda</span> val: val   对选中的值进行一次转换</span><br><span class="line">    empty_value= <span class="string">&#x27;&#x27;</span>            空值的默认值</span><br><span class="line">  </span><br><span class="line">MultipleChoiceField(ChoiceField)</span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">TypedMultipleChoiceField(MultipleChoiceField)</span><br><span class="line">    coerce = <span class="keyword">lambda</span> val: val   对选中的每一个值进行一次转换</span><br><span class="line">    empty_value= <span class="string">&#x27;&#x27;</span>            空值的默认值</span><br><span class="line">  </span><br><span class="line">ComboField(Field)</span><br><span class="line">    fields=()                  使用多个验证，如下：即验证最大长度<span class="number">20</span>，又验证邮箱格式</span><br><span class="line">                               fields.ComboField(fields=[fields.CharField(max_length=<span class="number">20</span>), fields.EmailField(),])</span><br><span class="line">  </span><br><span class="line">MultiValueField(Field)</span><br><span class="line">    PS: 抽象类，子类中可以实现聚合多个字典去匹配一个值，要配合MultiWidget使用</span><br><span class="line">  </span><br><span class="line">SplitDateTimeField(MultiValueField)</span><br><span class="line">    input_date_formats=<span class="literal">None</span>,   格式列表：[<span class="string">&#x27;%Y--%m--%d&#x27;</span>, <span class="string">&#x27;%m%d/%Y&#x27;</span>, <span class="string">&#x27;%m/%d/%y&#x27;</span>]</span><br><span class="line">    input_time_formats=<span class="literal">None</span>    格式列表：[<span class="string">&#x27;%H:%M:%S&#x27;</span>, <span class="string">&#x27;%H:%M:%S.%f&#x27;</span>, <span class="string">&#x27;%H:%M&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">FilePathField(ChoiceField)     文件选项，目录下文件显示在页面中</span><br><span class="line">    path,                      文件夹路径</span><br><span class="line">    <span class="keyword">match</span>=<span class="literal">None</span>,                正则匹配</span><br><span class="line">    recursive=<span class="literal">False</span>,           递归下面的文件夹</span><br><span class="line">    allow_files=<span class="literal">True</span>,          允许文件</span><br><span class="line">    allow_folders=<span class="literal">False</span>,       允许文件夹</span><br><span class="line">    required=<span class="literal">True</span>,</span><br><span class="line">    widget=<span class="literal">None</span>,</span><br><span class="line">    label=<span class="literal">None</span>,</span><br><span class="line">    initial=<span class="literal">None</span>,</span><br><span class="line">    help_text=<span class="string">&#x27;&#x27;</span></span><br><span class="line">  </span><br><span class="line">GenericIPAddressField</span><br><span class="line">    protocol=<span class="string">&#x27;both&#x27;</span>,           both,ipv4,ipv6支持的IP格式</span><br><span class="line">    unpack_ipv4=<span class="literal">False</span>          解析ipv4地址，如果是::ffff:<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>时候，可解析为<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>， PS：protocol必须为both才能启用</span><br><span class="line">  </span><br><span class="line">SlugField(CharField)           数字，字母，下划线，减号（连字符）</span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">UUIDField(CharField)           uuid类型</span><br></pre></td></tr></table></figure>

<h3 id="内直插件"><a href="#内直插件" class="headerlink" title="内直插件"></a>内直插件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">TextInput(Input)</span><br><span class="line">NumberInput(TextInput)</span><br><span class="line">EmailInput(TextInput)</span><br><span class="line">URLInput(TextInput)</span><br><span class="line">PasswordInput(TextInput)</span><br><span class="line">HiddenInput(TextInput)</span><br><span class="line">Textarea(Widget)</span><br><span class="line">DateInput(DateTimeBaseInput)</span><br><span class="line">DateTimeInput(DateTimeBaseInput)</span><br><span class="line">TimeInput(DateTimeBaseInput)</span><br><span class="line">CheckboxInput</span><br><span class="line">Select</span><br><span class="line">NullBooleanSelect</span><br><span class="line">SelectMultiple</span><br><span class="line">RadioSelect</span><br><span class="line">CheckboxSelectMultiple</span><br><span class="line">FileInput</span><br><span class="line">ClearableFileInput</span><br><span class="line">MultipleHiddenInput</span><br><span class="line">SplitDateTimeWidget</span><br><span class="line">SplitHiddenDateTimeWidget</span><br><span class="line">SelectDateWidget</span><br></pre></td></tr></table></figure>

<h2 id="校验字段功能"><a href="#校验字段功能" class="headerlink" title="校验字段功能"></a>校验字段功能</h2><p>在没有使用 forms 组件时，如果需要对数据进行校验，比如注册时，对用户名或者密码有位数限制等，我们需要首先获取数据然后手动进行判断，那么有了 forms 组件，这些事统统可以不用手动进行判断了，只需要把限制条件作为参数传进去那么就会自动进行判断。</p>
<h3 id="前端代码"><a href="#前端代码" class="headerlink" title="前端代码"></a>前端代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>邮箱: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="后端代码"><a href="#后端代码" class="headerlink" title="后端代码"></a>后端代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="comment"># 继承Form这个类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyForm</span>(forms.Form):</span><br><span class="line">    <span class="comment"># 限制name这个字段最长为8,最短为3</span></span><br><span class="line">    name=forms.CharField(min_length=<span class="number">3</span>,max_length=<span class="number">8</span>,label=<span class="string">&#x27;用户名&#x27;</span>,required=<span class="literal">True</span>,error_messages=&#123;<span class="string">&#x27;min_length&#x27;</span>:<span class="string">&#x27;至少为3&#x27;</span>,<span class="string">&#x27;max_length&#x27;</span>:<span class="string">&#x27;最长为8,您太长了&#x27;</span>&#125;)</span><br><span class="line">    pwd=forms.CharField(min_length=<span class="number">3</span>,max_length=<span class="number">8</span>,label=<span class="string">&#x27;密码&#x27;</span>,error_messages=&#123;<span class="string">&#x27;min_length&#x27;</span>:<span class="string">&#x27;至少为3&#x27;</span>,<span class="string">&#x27;max_length&#x27;</span>:<span class="string">&#x27;最长为8,您太长了&#x27;</span>&#125;)</span><br><span class="line">    email=forms.EmailField(label=<span class="string">&#x27;邮箱&#x27;</span>,error_messages=&#123;<span class="string">&#x27;invalid&#x27;</span>:<span class="string">&#x27;邮箱格式不合法&#x27;</span>,<span class="string">&#x27;required&#x27;</span>:<span class="string">&#x27;这个字段必填&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="comment"># 生成一个空的form对象</span></span><br><span class="line">        myform=MyForm()</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;register.html&#x27;</span>,<span class="built_in">locals</span>())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 生成对象,传参,传字典,要校验数据的字典</span></span><br><span class="line">        <span class="comment"># myform=MyForm(request.POST)</span></span><br><span class="line">        <span class="comment"># 自己写要校验的字典,数据多了,多的是不校验的,但是cleaned_data中也没有多出来的数据</span></span><br><span class="line">        <span class="comment"># dic=&#123;&#x27;name&#x27;:&#x27;lqz&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;email&#x27;:&#x27;22@qq.com&#x27;,&#x27;xx&#x27;:&#x27;xxx&#x27;&#125;</span></span><br><span class="line">        <span class="comment"># dic=&#123;&#x27;name&#x27;:&#x27;lqz&#x27;,&#x27;pwd&#x27;:&#x27;123&#x27;,&#x27;email&#x27;:&#x27;22&#x27;&#125;</span></span><br><span class="line">        dic=&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;lqzfgsdfgsdf&#x27;</span>,<span class="string">&#x27;pwd&#x27;</span>:<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;5555&#x27;</span>&#125;</span><br><span class="line">        myform = MyForm(dic)</span><br><span class="line">        <span class="comment"># 所有字典都校验通过,它就是True的</span></span><br><span class="line">        <span class="keyword">if</span> myform.is_valid():</span><br><span class="line">            <span class="comment"># 取出校验通过的数据</span></span><br><span class="line">            clean_data=myform.cleaned_data</span><br><span class="line">            <span class="built_in">print</span>(clean_data)</span><br><span class="line">            <span class="comment"># models.UserInfo.objects.create(**clean_data)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 所有的错误信息</span></span><br><span class="line">            <span class="comment"># 只要是校验通过的值,都在cleaned_data中放着</span></span><br><span class="line">            <span class="built_in">print</span>(myform.cleaned_data)</span><br><span class="line">            <span class="built_in">print</span>(myform.errors.as_data())</span><br><span class="line">            <span class="comment"># 字典类型</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">type</span>(myform.errors))</span><br><span class="line">            <span class="built_in">print</span>(myform.errors.get(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line">            <span class="keyword">from</span>  django.forms.utils <span class="keyword">import</span> ErrorDict</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="渲染标签功能"><a href="#渲染标签功能" class="headerlink" title="渲染标签功能"></a>渲染标签功能</h2><ol>
<li>渲染方式一</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>forms的模板渲染之一(推荐)<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名: &#123;&#123; myform.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码: &#123;&#123; myform.pwd &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>邮箱: &#123;&#123; myform.email &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>渲染方式二</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>forms的模板渲染之二(推荐)<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">    &#123;% for item in myform %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; item.label &#125;&#125;:&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>渲染方式三</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>forms的模板渲染之三<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">&#123;#    <span class="tag">&lt;<span class="name">table</span>&gt;</span>#&#125;</span><br><span class="line">&#123;#            &#123;&#123; myform.as_table &#125;&#125;#&#125;</span><br><span class="line">&#123;#    <span class="tag">&lt;/<span class="name">table</span>&gt;</span>#&#125;</span><br><span class="line"></span><br><span class="line">    &#123;&#123; myform.as_p &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="渲染错误信息功能"><a href="#渲染错误信息功能" class="headerlink" title="渲染错误信息功能"></a>渲染错误信息功能</h2><h3 id="前端代码-1"><a href="#前端代码-1" class="headerlink" title="前端代码"></a>前端代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/bootstrap-3.3.7-dist/css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/jquery-3.3.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6 col-md-offset-3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">            &#123;% for foo in myform %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; foo.label &#125;&#125;:&#123;&#123; foo &#125;&#125; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;pull-right&quot;</span>&gt;</span>&#123;&#123; foo.errors.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;error_all.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名:&#123;&#123; myform.name &#125;&#125; <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; myform.errors.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名:&#123;&#123; myform.pwd &#125;&#125; <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; myform.errors.pwd &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名:&#123;&#123; myform.email &#125;&#125; <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; myform.errors.email &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="后端代码-1"><a href="#后端代码-1" class="headerlink" title="后端代码"></a>后端代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app01.MyForm <span class="keyword">import</span> RegForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        myform = RegForm()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        myform = RegForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> myform.is_valid():</span><br><span class="line">            <span class="comment"># 存数据库,保存这个人</span></span><br><span class="line">            <span class="built_in">print</span>(myform.cleaned_data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 校验不通过,这里面也可能有值</span></span><br><span class="line">            <span class="comment"># 总错误信息&#123;&#x27;name&#x27;:[&#x27;太长了&#x27;,],&#x27;pwd&#x27;:[&#x27;太短了&#x27;]&#125;</span></span><br><span class="line">            <span class="comment"># print(myform.cleaned_data)</span></span><br><span class="line">            <span class="comment"># 总错误</span></span><br><span class="line">            <span class="comment"># myform.glo_err=myform.errors.get(&#x27;__all__&#x27;)</span></span><br><span class="line">            error_all = myform.errors.get(<span class="string">&#x27;__all__&#x27;</span>)</span><br><span class="line">            <span class="comment"># print()</span></span><br><span class="line">            <span class="comment"># 每一个的错误信息</span></span><br><span class="line">            <span class="comment"># for item in myform:</span></span><br><span class="line">            <span class="comment">#     # [&#x27;太长了&#x27;,]</span></span><br><span class="line">            <span class="comment">#     # print(item.errors[0])</span></span><br><span class="line">            <span class="comment">#     # print(type(item.errors))</span></span><br><span class="line">            <span class="comment">#     from django.forms.utils import ErrorList</span></span><br><span class="line">            <span class="comment">#     # print(item.errors.as_data())</span></span><br><span class="line">            <span class="comment">#     print(item.errors)</span></span><br><span class="line">            <span class="comment">#     # print(type(item.errors))</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;register.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<h2 id="组件的参数设置"><a href="#组件的参数设置" class="headerlink" title="组件的参数设置"></a>组件的参数设置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RegForm</span>(forms.Form):</span><br><span class="line">    name = forms.CharField(max_length=<span class="number">8</span>, min_length=<span class="number">3</span>, label=<span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">                           error_messages=&#123;<span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;太长了&#x27;</span>,</span><br><span class="line">                                           <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;太短了&#x27;</span>,</span><br><span class="line">                                           <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该项不能为空&#x27;</span></span><br><span class="line">                                           &#125;,</span><br><span class="line">                           widget=widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">                           )</span><br><span class="line">    pwd = forms.CharField(max_length=<span class="number">8</span>, min_length=<span class="number">3</span>, label=<span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">                          error_messages=&#123;<span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;太长了&#x27;</span>,</span><br><span class="line">                                          <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;太短了&#x27;</span>,</span><br><span class="line">                                          <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该项不能为空&#x27;</span></span><br><span class="line">                                          &#125;,</span><br><span class="line">                          widget=widgets.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">                          )</span><br><span class="line">    re_pwd = forms.CharField(max_length=<span class="number">8</span>, min_length=<span class="number">3</span>, label=<span class="string">&#x27;确认密码&#x27;</span>,</span><br><span class="line">                          error_messages=&#123;<span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;太长了&#x27;</span>,</span><br><span class="line">                                          <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;太短了&#x27;</span>,</span><br><span class="line">                                          <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该项不能为空&#x27;</span></span><br><span class="line">                                          &#125;,</span><br><span class="line">                          widget=widgets.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">                          )</span><br><span class="line">    email = forms.EmailField(label=<span class="string">&#x27;邮箱&#x27;</span>, error_messages=&#123;<span class="string">&#x27;invalid&#x27;</span>: <span class="string">&#x27;格式不正确&#x27;</span>,</span><br><span class="line">                                                         <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该项不能为空&#x27;</span></span><br><span class="line">                                                         &#125;,</span><br><span class="line">                             widget=widgets.EmailInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">                             )</span><br></pre></td></tr></table></figure>

<h2 id="局部钩子"><a href="#局部钩子" class="headerlink" title="局部钩子"></a>局部钩子</h2><p>继承自 Form类的校验类，可以对类中的每个字段进行校验，校验通过后的数据会放在 clean_data中，没通过的放在errors中，可以通过字段名取值，那么校验通过的字段如果还需要进行其他的判断，比如是否有敏感词，这些单单依靠字段的校验是完成不了的。所以 Django 提供了局部钩子函数，当每个字段进行校验完成后会自动调用该钩子函数。看源码就很清楚了。</p>
<p>首先，所有的数据校验都是调用了 Form 对象的 is_valid()方法进行的。所以进入is_valid()方法。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzcz92yo0ej317e05wq43.jpg"></p>
<p><code>self.is_bound</code>为 True，所以进入<code>self.errors</code>方法，为什么没加括号呢，因为被<code>property</code>装饰了，变成了属性。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzczcfh6iaj314y06wab7.jpg"></p>
<p><code>self._errors</code>为<code>None</code>，进入<code>full_clean()</code>方法。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fzczdidcywj319u0hejur.jpg"></p>
<p>在这个方法里，首先定义了<code>cleaned_data</code>为一个空字典，然后就是下面的三个方法：</p>
<ol>
<li>_clean_fields()：见名思义，这个方法是用来校验字段的，就是继承自 Form 中类里面定义的字段。</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fzczg7pul5j31a00km7a0.jpg"></p>
<p>光看源码不看例子很难理解，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyForm</span>(forms.Form):</span><br><span class="line">    name = forms.CharField(min_length=<span class="number">3</span>, max_length=<span class="number">8</span>, label=<span class="string">&#x27;用户名&#x27;</span>, required=<span class="literal">True</span>, error_messages=&#123;<span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;用户名长度至少为三位&#x27;</span>, <span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;用户名长度最长为八位&#x27;</span>, &#125;)</span><br><span class="line">    pwd = forms.CharField(min_length=<span class="number">3</span>, max_length=<span class="number">8</span>, label=<span class="string">&#x27;密码&#x27;</span>, required=<span class="literal">True</span>, error_messages=&#123;<span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;用户名长度至少为三位&#x27;</span>, <span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;用户名长度最长为八位&#x27;</span>, &#125;)</span><br><span class="line">    email = forms.EmailField(label=<span class="string">&#x27;邮箱&#x27;</span>, error_messages=&#123;<span class="string">&#x27;invalid&#x27;</span>: <span class="string">&#x27;邮箱格式不合法&#x27;</span>, <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该字段必填&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>在<code>self.fields</code>中放的是一个个键值对，比如在上面的<code>MyForm</code>里面的字段<code>name</code>和后面的<code>CharField</code>类的一个对象的对应关系，那么在<code>self.fields</code>里面就有三个对应关系，也就是有三个键值对。</p>
<p>往下走，字典的<code>items()</code>方法，把<code>MyForm</code>里面的字段值赋给了<code>name</code>，把字段指向的类对象赋给了<code>field</code>，之后进行判断，<code>if field.disable:</code>，这个判断是判断类对象的某个属性值，可以知道在定义字段时，并没有定义这个值，那么这个值是否有默认值，进入<code>forms.CharField</code>中查看，</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fzcznprlzlj31dk0buwip.jpg"></p>
<p>可以看出该类中没有，那么去父类中查看也就是<code>Field</code>：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzczogetz7j318g0iw0zc.jpg"></p>
<p>找到了，默认为 False， 所以说<code>if field.disables:</code>为 False， 就走到了下一步：</p>
<p><code>value = field.widget.value_from_datadict(self.data, self.files, self.add_prefix(name))</code>这句看不懂，接着往下走：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzczw7tovmj31580c6q61.jpg"></p>
<p>首先，咱们定义的都不是<code>FileField</code>字段，所以走<code>value=field.clean(value)</code>：</p>
<p>因为是字段的方法，所以找<code>forms.CharField</code>，在<code>Field</code>类中找到：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fzczyp19qjj312y0b8abt.jpg"></p>
<p>这里面有点绕，我先把顺序写出来：</p>
<p>首先要知道<code>value</code>到底是什么：</p>
<p>在上面说过调用了<code>field.widget.value_from_datadict(self.data, self.files, self.add_prefix(name))</code>方法，是字段的方法，</p>
<p>在<code>CharField</code>中没找到<code>widget</code>，去<code>Field</code>中寻找，</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fzd04jmccnj316c0lkahe.jpg"></p>
<p>可以看到<code>widget=TextInput</code>，所以肯定是调用了<code>Textinput</code>的<code>value_from_datadict</code>方法，</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fzd05oun0bj314404iaay.jpg"></p>
<p>没有，去<code>Input</code>，</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fzd064k2knj31ae0gmjvl.jpg"></p>
<p>还是没有，去<code>Widget</code>，</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fzd06nkwyuj30xe06iabb.jpg"></p>
<p>找到，返回了<code>data.get(name)</code>，很显然这是字典的取值方法，但是<code>data</code>是什么呢？</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzd0ueebz8j31eo0ckn1q.jpg"></p>
<p><code>data</code>是个<code>QueryDict</code>对象，找到<code>name</code>是什么，就可以知道<code>value</code>是什么了。</p>
<p>可以知道<code>name</code>是通过<code>self.add_prefix(name)</code>获取的，进入：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fzd0wrytjqj318m08cmyw.jpg"></p>
<p>是个三元表达式，关键在于<code>self.prefix</code>的值是多少。这是个对象属性，很显然去类中找：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fzd0y6275kj31a00fmtg2.jpg"></p>
<p>所以这个三元表达式的值就是<code>MyForm</code>中定义的字段名，所以通过<code>data.get(name)</code>取得值就是上传的值，比如<code>musibii</code>。</p>
<p>那么执行<code>field.clean(value)</code>相当于把<code>musibii</code>传进去执行，</p>
<p>在<code>field.clean</code>方法中：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fzd12155xrj30xu0bkabx.jpg"></p>
<ol>
<li>to_python(‘musibii’)：因为<code>CharField</code>中定义了<code>to_python</code>方法，所以进入自己的方法;</li>
</ol>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fzd15i7025j31co08mdi8.jpg"></p>
<p><code>musibii</code>不是None，空字符串、空字典、空元祖，所以进入<code>forece_text(&#39;musibii&#39;)</code>方法：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzd17quomwj315v0u0tja.jpg"></p>
<p>别看这么多，其实就进行了一步判断：<code>if issubclass(type(&#39;musibii&#39;), six.text_type):</code>因为这个判断为<code>True</code>，</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fzd1eefd01j312y09kabq.jpg"></p>
<p>所以直接把<code>musibii</code>返回。然后判断<code>if self.strip:</code>因为该参数默认为<code>True</code>，所以<code>value=value.strip()</code>，默认是通过空格进行分割的，走完后后进入<code>self.valitate(&#39;musibii&#39;)</code>，</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fzd1gbxww9j31a403egmw.jpg"></p>
<p>直接退出进入<code>run_validators(&#39;musibii&#39;)</code>，</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzd1h8mo5rj31dm0d0n0n.jpg"></p>
<p>在这个方法里面，主要是进行了字段的一些限制校验，比如长度等，<code>musibii</code>没有错误，返回<code>musibii</code>，然后把该数据加到<code>self.cleaned_data</code>中，表示这个数据是成功通过校验的。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzd1ml7sxtj319c06g76a.jpg"></p>
<p>这句代码是反射用法，判断<code>self</code>是否具有<code>clean_name</code>属性，（name 变量的值为 name），因为没有，所以第一个字段的校验结束，进行第二个字段的校验。</p>
<p>如果我们在<code>MyForm</code>类中定义了<code>clean_name</code>或者<code>clean_pwd</code>或者<code>clean_email</code>方法，如果在<code>_clean_fields</code>方法中通过校验就会执行自定义的校验方法，这就是局部钩子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RegForm</span>(forms.Form):</span><br><span class="line">    name = forms.CharField(max_length=<span class="number">8</span>, min_length=<span class="number">3</span>, label=<span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">                           error_messages=&#123;<span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;太长了&#x27;</span>,</span><br><span class="line">                                           <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;太短了&#x27;</span>,</span><br><span class="line">                                           <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该项不能为空&#x27;</span></span><br><span class="line">                                           &#125;,</span><br><span class="line">                           widget=widgets.TextInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">                           )</span><br><span class="line">    pwd = forms.CharField(max_length=<span class="number">8</span>, min_length=<span class="number">3</span>, label=<span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">                          error_messages=&#123;<span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;太长了&#x27;</span>,</span><br><span class="line">                                          <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;太短了&#x27;</span>,</span><br><span class="line">                                          <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该项不能为空&#x27;</span></span><br><span class="line">                                          &#125;,</span><br><span class="line">                          widget=widgets.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">                          )</span><br><span class="line">    re_pwd = forms.CharField(max_length=<span class="number">8</span>, min_length=<span class="number">3</span>, label=<span class="string">&#x27;确认密码&#x27;</span>,</span><br><span class="line">                          error_messages=&#123;<span class="string">&#x27;max_length&#x27;</span>: <span class="string">&#x27;太长了&#x27;</span>,</span><br><span class="line">                                          <span class="string">&#x27;min_length&#x27;</span>: <span class="string">&#x27;太短了&#x27;</span>,</span><br><span class="line">                                          <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该项不能为空&#x27;</span></span><br><span class="line">                                          &#125;,</span><br><span class="line">                          widget=widgets.PasswordInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">                          )</span><br><span class="line">    email = forms.EmailField(label=<span class="string">&#x27;邮箱&#x27;</span>, error_messages=&#123;<span class="string">&#x27;invalid&#x27;</span>: <span class="string">&#x27;格式不正确&#x27;</span>,</span><br><span class="line">                                                         <span class="string">&#x27;required&#x27;</span>: <span class="string">&#x27;该项不能为空&#x27;</span></span><br><span class="line">                                                         &#125;,</span><br><span class="line">                             widget=widgets.EmailInput(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;form-control&#x27;</span>&#125;)</span><br><span class="line">                             )</span><br><span class="line">    <span class="comment"># clean_字段名字</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clean_name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 从cleaned_data中取出字段的值</span></span><br><span class="line">        name = self.cleaned_data.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        <span class="comment"># # 校验是否以sb开头</span></span><br><span class="line">        <span class="keyword">if</span> name.startswith(<span class="string">&#x27;sb&#x27;</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;不能以sb开头&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> name</span><br><span class="line">        <span class="comment"># user = models.UserInfo.objects.filter(name=name).first()</span></span><br><span class="line">        <span class="comment"># if user:</span></span><br><span class="line">        <span class="comment">#     # 用户已经存在,校验不通过,抛一个异常</span></span><br><span class="line">        <span class="comment">#     raise ValidationError(&#x27;该用户已经存在&#x27;)</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     # 校验通过,返回要校验的数据</span></span><br><span class="line">        <span class="comment">#     return name</span></span><br><span class="line">    <span class="comment"># def clean_pwd(self):</span></span><br><span class="line">    <span class="comment">#     pass</span></span><br></pre></td></tr></table></figure>

<p>在这里，如果<code>name</code>字段校验通过就会执行<code>clean_name</code>这个方法进行进一步的校验。</p>
<h2 id="全局钩子"><a href="#全局钩子" class="headerlink" title="全局钩子"></a>全局钩子</h2><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzd25040lej319k0gm77o.jpg"></p>
<p>当<code>_clean_fields</code>运行结束后会执行<code>_clean_form</code>方法，</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fzd2fjs5cpj314008u0u8.jpg"></p>
<p>如果<code>MyForm</code>中定义了<code>clean</code>方法的话就会执行该方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">clean</span>(<span class="params">self</span>):</span><br><span class="line">        pwd=self.cleaned_data.get(<span class="string">&#x27;pwd&#x27;</span>)</span><br><span class="line">        re_pwd=self.cleaned_data.get(<span class="string">&#x27;re_pwd&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> pwd==re_pwd:</span><br><span class="line">            <span class="comment"># 正确,返回self.cleaned_data</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 校验失败,抛异常</span></span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;两次密码不一致&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>比如要判断两次密码是否一致就可以定义一个全局钩子函数。</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h3 id="模板层"><a href="#模板层" class="headerlink" title="模板层"></a>模板层</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/bootstrap-3.3.7-dist/css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/jquery-3.3.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6 col-md-offset-3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">            &#123;% for foo in myform %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; foo.label &#125;&#125;:&#123;&#123; foo &#125;&#125; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;pull-right&quot;</span>&gt;</span>&#123;&#123; foo.errors.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;error_all.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        myform = RegForm()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        myform = RegForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> myform.is_valid():</span><br><span class="line">            <span class="comment"># 存数据库,保存这个人</span></span><br><span class="line">            <span class="built_in">print</span>(myform.cleaned_data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 校验不通过,这里面也可能有值</span></span><br><span class="line">            <span class="comment"># 总错误信息&#123;&#x27;name&#x27;:[&#x27;太长了&#x27;,],&#x27;pwd&#x27;:[&#x27;太短了&#x27;]&#125;</span></span><br><span class="line">            <span class="comment"># print(myform.cleaned_data)</span></span><br><span class="line">            <span class="comment"># 总错误</span></span><br><span class="line">            <span class="comment"># myform.glo_err=myform.errors.get(&#x27;__all__&#x27;)</span></span><br><span class="line">            error_all = myform.errors.get(<span class="string">&#x27;__all__&#x27;</span>)</span><br><span class="line">            <span class="comment"># print()</span></span><br><span class="line">            <span class="comment"># 每一个的错误信息</span></span><br><span class="line">            <span class="comment"># for item in myform:</span></span><br><span class="line">            <span class="comment">#     # [&#x27;太长了&#x27;,]</span></span><br><span class="line">            <span class="comment">#     # print(item.errors[0])</span></span><br><span class="line">            <span class="comment">#     # print(type(item.errors))</span></span><br><span class="line">            <span class="comment">#     from django.forms.utils import ErrorList</span></span><br><span class="line">            <span class="comment">#     # print(item.errors.as_data())</span></span><br><span class="line">            <span class="comment">#     print(item.errors)</span></span><br><span class="line">            <span class="comment">#     # print(type(item.errors))</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;register.html&#x27;</span>, <span class="built_in">locals</span>())</span><br></pre></td></tr></table></figure>

<p><strong>全局钩子产生的错误会放到myform.errors[__all__]中</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://rsuxwvilc.github.io">vilc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://rsuxwvilc.github.io/2019/01/20/Django%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89/">https://rsuxwvilc.github.io/2019/01/20/Django%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/01/20/Django%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89/"><img class="prev-cover" src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Django（十七）</div></div></a></div><div class="next-post pull-right"><a href="/2019/01/20/Django%EF%BC%88%E5%8D%81%E4%BA%94%EF%BC%89/"><img class="next-cover" src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Django（十五）</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">vilc</div><div class="author-info__description">Linux Python Vim Git</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">141</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">39</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/rsuxwvilc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/rsuxwvilc" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:shaozuanzuan@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Django-%E7%B3%BB%E5%88%97%E5%8D%9A%E5%AE%A2%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">Django 系列博客（十六）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">基本属性介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Form-%E7%B1%BB%E5%86%85%E7%BD%AE%E5%AD%97%E6%AE%B5%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.1.</span> <span class="toc-text">Form 类内置字段介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%9B%B4%E6%8F%92%E4%BB%B6"><span class="toc-number">1.2.2.</span> <span class="toc-text">内直插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E5%AD%97%E6%AE%B5%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.</span> <span class="toc-text">校验字段功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.1.</span> <span class="toc-text">前端代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.2.</span> <span class="toc-text">后端代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E6%A0%87%E7%AD%BE%E5%8A%9F%E8%83%BD"><span class="toc-number">1.4.</span> <span class="toc-text">渲染标签功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E5%8A%9F%E8%83%BD"><span class="toc-number">1.5.</span> <span class="toc-text">渲染错误信息功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.5.1.</span> <span class="toc-text">前端代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.5.2.</span> <span class="toc-text">后端代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.6.</span> <span class="toc-text">组件的参数设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E9%92%A9%E5%AD%90"><span class="toc-number">1.7.</span> <span class="toc-text">局部钩子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%92%A9%E5%AD%90"><span class="toc-number">1.8.</span> <span class="toc-text">全局钩子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">1.9.</span> <span class="toc-text">应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%B1%82"><span class="toc-number">1.9.1.</span> <span class="toc-text">模板层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%B1%82"><span class="toc-number">1.9.2.</span> <span class="toc-text">视图层</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><div class="content"><a class="title" href="/2020/07/08/Sorting-HOW-TO/" title="Sorting HOW TO">Sorting HOW TO</a><time datetime="2020-07-08T09:40:07.000Z" title="Created 2020-07-08 17:40:07">2020-07-08</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/2019/12/10/python-%E8%B0%83%E8%AF%95%E5%99%A8%E4%B9%8B-pdb/" title="python 调试器之 pdb">python 调试器之 pdb</a><time datetime="2019-12-10T05:50:16.000Z" title="Created 2019-12-10 13:50:16">2019-12-10</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/2019/10/18/%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%B8%80/" title="数据库（一）">数据库（一）</a><time datetime="2019-10-18T06:23:45.000Z" title="Created 2019-10-18 14:23:45">2019-10-18</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/2019/10/18/hello-world/" title="Hello World">Hello World</a><time datetime="2019-10-18T06:23:43.000Z" title="Created 2019-10-18 14:23:43">2019-10-18</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/2019/07/27/ubuntu-%E5%AE%89%E8%A3%85-Docker-CE/" title="ubuntu 安装 Docker CE">ubuntu 安装 Docker CE</a><time datetime="2019-07-27T08:13:19.000Z" title="Created 2019-07-27 16:13:19">2019-07-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By vilc</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>